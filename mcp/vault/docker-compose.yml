# docker-compose.yml

services:
  vault-mcp:
    image: envector/vault-mcp:latest
    container_name: vault-mcp
    
    volumes:
      # Keys (encrypted at rest)
      - ./keys:/secure/keys:rw
      # Backups
      - ./backups:/secure/backups:rw
      # Logs
      - ./logs:/var/log/vault-mcp:rw
    
    environment:
      - VAULT_ENCRYPTION_KEY=${VAULT_ENCRYPTION_KEY}
      - VAULT_AUTH_TOKEN=${VAULT_AUTH_TOKEN}
    
    networks:
      - vault-internal
    
    ports:
      # Only expose on localhost
      - "127.0.0.1:50080:50080"
    
    security_opt:
      - no-new-privileges:true
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "vault-mcp", "health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  vault-internal:
    driver: bridge
    internal: true  # No external access